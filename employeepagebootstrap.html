<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>ShiftScheduler - Employee</title>
	<script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
		integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous">
    </script>
    <script src=
"https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js">
    </script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
		integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous">
    </script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
		integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous">
    </script>
	<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
		  integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">

</head>
<style>
.footer {
  position: absolute;
  bottom: 0;
  width: 100%;
  /* Set the fixed height of the footer here */
  height: 60px;
  line-height: 60px; /* Vertically center the text there */
  background-color: #f5f5f5;
}
</style>

<body id="body" class="text-center">
	<nav class="navbar navbar-expand navbar-light bg-light">
		<div class="container">
          <a class="navbar-brand" href="/">ShiftScheduler
          </a>
          <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
                  aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon">
            </span>
          </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
                           aria-haspopup="true" aria-expanded="false"> {{netid}} </a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">
                          <a class="dropdown-item" href="/profile">Profile</a>
                          <a class="dropdown-item" href="#">Log Out</a>
                        </div>
                    </li>
                </ul>
            </div>
	    </div>
    </nav>

<main role="main">
	<div class="container">
		<br>
		<h1 style = "font-size: 20px">This Week's Calendar:</h1>
		<br>
	  <table class="table" align="center" cellpadding="10" cellspacing="5">
          <thead>
             <tr>
                <th>Monday</th>
                <th>Tuesday</th>
                <th>Wednesday</th>
                <th>Thursday</th>
                <th>Friday</th>
                <th>Saturday</th>
                <th>Sunday</th>
             </tr>
             <tr>
                <td id="monDate"></td>
                <td id="tuesDate"></td>
                <td id ="wedDate"></td>
                <td id ="thursDate"></td>
                <td id="friDate"></td>
                <td id="satDate"></td>
                <td id="sunDate"></td>
             </tr>
          </thead>
          <tbody>
		 <tr>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<td></td>
			<!--Saturday Brunch-->
			 <td id="satBrunch" day ="5" >
				<div class="list-group">
<!--					<div class="list-group" style = "width: 75px; font-size:12px" >-->
					<a id="5-7" taskid = 7 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift" > Manager</a>
					<a data-href = '/shiftdetails' id="5-8" taskid = 8 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Brunch</a>
					 <a data-href = '/shiftdetails' id="5-9" taskid = 9 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Brunch</a>
				</div>
			</td>
<!--			 <td id="satBrunchDish" day ="5">-->
<!--				<div class="list-group" style = "width: 75px; font-size:12px" >-->
<!--					<a id="satBrunchDishManager" taskid = 10 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"-->
<!--					   data-target="#otherShift" >Dish Manager</a>-->
<!--					<a data-href = '/shiftdetails' id="satFirstBrunchDish" taskid = 11 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"-->
<!--					   data-target="#otherShift">First Dish</a>-->
<!--					 <a data-href = '/shiftdetails' id="satSecondBrunchDish" taskid = 12 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"-->
<!--					   data-target="#otherShift">Second Dish</a>-->
<!--				</div>-->
<!--			</td>-->
			<!--Sunday Brunch-->
			  <td id="sunBrunch" day ="6">
				<div class="list-group" >
					<a id="6-7" taskid = 7 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift" >Manager   </a>
					<a id="6-8" taskid = 8 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift" >First Brunch</a>
					 <a id="6-9" taskid = 9 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Brunch</a>
<!--					<a id="sunDishhManager" taskid = 10 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"-->
<!--					   data-target="#otherShift" style = "height: 30px; font-size:12px">Manager</a>-->
<!--					<a id="sunFirstBrunchDish" taskid = 11 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"-->
<!--					   data-target="#otherShift" style = "height: 45px; font-size:12px">First Brunch</a>-->
<!--					 <a id="sunSecondBrunchDish" taskid = 12 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"-->
<!--					   data-target="#otherShift" style = "height: 45px; font-size:12px">Second Brunch</a>-->
				</div>
			</td>
		 </tr>

		 <tr>
			<!--Monday Dinner-->
			<td id="monDinner" day ="0">
				<div class="list-group">
					<a id="0-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#yourShift">Manager</a>
					<a id="0-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Dinner</a>
					 <a id="0-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Dinner</a>
				</div>
			</td>
				 <!--Tuesday Dinner-->
			 <td id="tuesDinner" day ="1">
				<div class="list-group">
					<a data-href = '/shiftdetails' id="1-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Manager</a>
					<a data-href = '/shiftdetails' id="1-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Dinner</a>
					 <a data-href = '/shiftdetails' id="1-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Dinner</a>
				</div>
			</td>

			<!--Wednesday Dinner-->
			  <td id="wedDinner" day ="2">
				<div class="list-group">
					<a data-href = '/shiftdetails' id="2-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Manager</a>
					<a data-href = '/shiftdetails' id="2-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Dinner</a>
					 <a data-href = '/shiftdetails' id="2-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Dinner</a>
				</div>
			</td>
			<!--Thursday Dinner-->
			  <td id="thurDinner" day ="3">
				<div class="list-group">
					<a data-href = '/shiftdetails' id="3-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Manager</a>
					<a data-href = '/shiftdetails' id="3-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Dinner</a>
					 <a data-href = '/shiftdetails' id="3-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Dinner</a>
				</div>
			</td>
			<!--Friday Dinner-->
			  <td id="friDinner" day ="4">
				<div class="list-group">
					<a data-href = '/shiftdetails' id="4-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Manager</a>
					<a data-href = '/shiftdetails' id="4-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Dinner</a>
					 <a data-href = '/shiftdetails' id="4-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Dinner</a>
				</div>
			</td>
			<!--Saturday Dinner-->
			  <td id="satDinner" day ="5">
				<div class="list-group">
					<a data-href = '/shiftdetails' id="5-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Manager</a>
					<a data-href = '/shiftdetails' id="5-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Dinner</a>
					 <a data-href = '/shiftdetails' id="5-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Dinner</a>
				</div>
			</td>
			<!--Sunday Dinner-->
			  <td id="sunDinner" day ="6">
				<div class="list-group">
					<a data-href = '/shiftdetails' id="6-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Manager</a>
					<a data-href = '/shiftdetails' id="6-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">First Dinner</a>
					 <a data-href = '/shiftdetails' id="6-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light" data-container="body" data-toggle="modal"
					   data-target="#otherShift">Second Dinner</a>
				</div>
			</td>
		 </tr>
          </tbody>
	  </table>

		<div class="modal fade" id="otherShift" tabindex="-1" role="dialog" aria-labelledby="otherShiftLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					 <div class="modal-header">
						 <h5 class="modal-title" id="otherShiftLabel">Shift Details</h5>
						 <button type="button" class="close" data-dismiss="modal" aria-label="Close">
							 <span aria-hidden="true">&times;</span>
						</button>
					 </div>
                    <div class="modal-body" id="otherShiftBody">
                     <p id="otherShiftText"></p>
					</div>
                     <div class="modal-footer">
						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                     </div>
				</div>
			</div>
		</div>

			<div class="modal fade" id="yourShift" tabindex="-1" role="dialog" aria-labelledby="yourShiftLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					 <div class="modal-header">
						 <h5 class="modal-title" id="yourShiftLabel">Shift Details</h5>
						 <button id = "subOutClose"  data-dismiss="modal" type="button" class="close"  aria-label="Close">
							 <span aria-hidden="true">&times;</span>
						</button>
					 </div>
                    <div class="modal-body" id="yourShiftBody">
                     <p id="yourShiftText"></p>
						</div>
                     <div class="modal-footer">
						 <div id="sub-out-text"></div>
<!--						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
						 <button type="button" id="subOutButton" class="btn btn-secondary">Sub-Out</button>
                     </div>
				</div>
			</div>
		</div>

				<div class="modal fade" id="needsSubShift" tabindex="-1" role="dialog" aria-labelledby="needsSubShiftLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					 <div class="modal-header">
						 <h5 class="modal-title" id="needsSubShiftLabel">Shift Details</h5>
						 <button id = "subInClose" type="button" data-dismiss="modal" class="close" aria-label="Close">
							 <span aria-hidden="true">&times;</span>
						</button>
					 </div>
                    <div class="modal-body" id="needsSubShiftBody">
                     <p id="needsSubShiftText"></p>
						</div>
                     <div class="modal-footer">
						 <div id="sub-in-text"></div>
<!--						<button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>-->
						 <button type="button" id="subInButton" class="btn btn-secondary">Sub-In</button>
                     </div>
				</div>
			</div>
		</div>


	  <br>
	  <strong>{{errorMsg}}</strong>
	</div>
</main>

<!--	<input type="hidden" id="myShifts">-->
<!--	<input type="hidden" id="needsSubShifts">-->

	<div id="myShifts"></div>
	<div id="needsSubShifts"> </div>


	<footer class="footer">
	  <div class="container">
		  <span class="text-muted">&copy; <a class = "text-dark" href="/team">The ShiftScheduler Team</a> 2020</span>
	  </div>
	</footer>

	<script>
		function getDates() {
			let today = new Date();

			let dotw = today.getDay();
			if(dotw == 0){
				dotw = 6;
			}

			mon = today.getDate() - dotw + 1;
			let week = [];
			let current = new Date();
			current.setDate(mon);
			for (var i = 0; i < 7; i++) {
				week.push(new Date(+current));
				current.setDate(current.getDate()+1);
			}
			$('#monDate').html(week[0].toLocaleDateString());
			$('#tuesDate').html(week[1].toLocaleDateString());
			$('#wedDate').html(week[2].toLocaleDateString());
			$('#thursDate').html(week[3].toLocaleDateString());
			$('#friDate').html(week[4].toLocaleDateString());
			$('#satDate').html(week[5].toLocaleDateString());
			$('#sunDate').html(week[6].toLocaleDateString());
			// return week[0];
			var test = new Date(2020, 3, 13);
			return test;
		}

		function getColors(mon) {
			url = '/myShifts'
			$('#myShifts').load(url, function(responseTxt, statusTxt, xhr){


				var found = false;
				for (var i = 0; i < responseTxt.length; i++) {
					curr = responseTxt[i];
					console.log(curr);
					if (curr == "\"") {
						if (!found) {
							found = true;
							var id = "#" + responseTxt.substring(i + 1, i + 4);
							// console.log(id);
							$(id).attr("class", "list-group-item list-group-item-action list-group-item-info");
							$(id).attr("data-target", "#yourShift");
						}
						else {
							found = false;
						}
					}
				}
			});
			console.log("mon2: "  + mon);
			url = '/needSubShifts?mon=' + mon
			$('#needsSubShifts').load(url, function(responseTxt, statusTxt, xhr){
				// console.log(responseTxt);
				var found = false;
				for (var i = 0; i < responseTxt.length; i++) {
					curr = responseTxt[i];
					// console.log(curr);
					if (curr == "\"") {
						if (!found) {
							found = true;
							var id = "#" + responseTxt.substring(i + 1, i + 4);
							// console.log(id);
							$(id).attr("class", "list-group-item list-group-item-action list-group-item-danger");
							$(id).attr("data-target", "#needsSubShift");
						}
						else {
							found = false;
						}
					}
				}
			});
		}

		function subOut() {
		 	$('#subOutButton').on('click',function() {
				var url = "/subOut?date=";
				var taskId = $(this).attr('taskid');
				var date = $(this).attr('date');
				url += date + "&taskid=" + taskId;
				console.log(url);
				$('#sub-out-text').load(url,function() {
						$('#yourShift').modal('show');
				});

		 	});
		}

		function subIn() {
			$('#subInButton').on('click',function() {
				var url = "/subIn?date=";
				var taskId = $(this).attr('taskid');
				var date = $(this).attr('date');
				url += date + "&taskid=" + taskId;
				console.log(url);
				$('#sub-in-text').load(url,function() {
						$('#modalBody').modal('show');

				});

		 	});
		}

        function getModalData(mon) {
            $('[data-toggle="modal"]').on('click',function() {
                var dataURL = "/shiftdetails";
                var taskId = $(this).attr('taskid');
                var dotw = $(this).parents('td').attr("day");
                var date = new Date();
                date.setFullYear(mon.getFullYear(), mon.getMonth(), mon.getDate());
                date.setDate(date.getDate() + parseInt(dotw));
                iso = date.toISOString().substring(0, 10);

                console.log(iso);
                dataURL += "?date=" + iso;
                dataURL += "&taskid=" + taskId;
                var modalId = $(this).attr('data-target');
                $('#subOutButton').attr('date', iso);
                $('#subOutButton').attr('taskid', taskId);
                $('#subInButton').attr('date', iso);
                $('#subInButton').attr('taskid', taskId);
                if (modalId == '#otherShift') {
                	console.log("here");
                	$('#otherShiftText').load(dataURL,function() {
						$('#otherShift').modal('show');
					});
                }
                else if (modalId == '#yourShift') {
                	console.log(modalId);
                	$('#yourShiftText').load(dataURL,function() {
                		$('#otherShift').modal('hide');
                		$('#otherShift').modal('hide');
						$('#yourShift').modal({show:true});
					});
                }
                else {
                	$('#needsSubShiftText').load(dataURL,function() {
                		$('#otherShift').modal('hide');
                		$('#otherShift').modal('hide');
						$('#modal-body').modal({show:true});
					});
                }
             });
        }

		function setup() {
			mon = getDates();

			monFormat = mon.getFullYear() + '-';
			if(mon.getMonth() < 10 ){
				monFormat += "0" + (mon.getMonth()+1) + '-';
			}else{
				monFormat += mon.getMonth() + '-' ;
			}
			monFormat += mon.getDate();
			getModalData(mon);
			getColors(monFormat);
			subOut();
			subIn();

		}

		$('document').ready(setup);
	</script>
</body>
</html>