<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ShiftScheduler - Coordinator</title>
  <!-- JQuery -->
  <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js"
  integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n"
  crossorigin="anonymous"></script>
  <!-- AJax -->
  <script src=
  "https://ajax.googleapis.com/ajax/libs/jquery/3.4.0/jquery.min.js"></script>
  <!-- PopperJS -->
  <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"
  integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo"
  crossorigin="anonymous"></script>
  <!-- Bootstrap -->
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"
  integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6"
  crossorigin="anonymous"></script>
  <!-- Bootstrap -->
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"
  integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"
  crossorigin="anonymous">
  <!-- FontAwesome -->
  <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
</head>

<style>
.footer {
  position: fixed;
  bottom: 0;
  width: 100%;
  /* Set the fixed height of the footer here */
  height: 60px;
  line-height: 60px; /* Vertically center the text there */
  background-color: #f5f5f5;
}
</style>

<!-- Navbar -->
<body id="body" class="text-center">
  <nav class="navbar navbar-expand navbar-light bg-light">
    <div class="container">
      <a class="navbar-brand" href="/index" style="font-size:25px">ShiftScheduler
      </a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon">
      </span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav">
        <li class="nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown"
          aria-haspopup="true" aria-expanded="false" style="font-size:18px"> {{netid}} </a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
            <a class="dropdown-item" href="/profile">Profile</a>
            <a class="dropdown-item" href="/logout">Log Out</a>
          </div>
        </li>
      </ul>
    </div>
  </div>
</nav>

<nav class="container navbar navbar-expand-lg navbar-dark bg-dark">
  <!--  <a class="navbar-brand" href="#">Navbar w/ text</a>-->
  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarText" aria-controls="navbarText" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon" ></span>
  </button>
  <div class="collapse navbar-collapse" id="navbarText">
    <ul class="navbar-nav mr-auto">
      <!--      <li class="nav-item active">-->
      <!--        <a class="nav-link" href="#"> Coordinator Page <span class="sr-only">(current)</span></a>-->
      <!--      </li>-->
      <li class="nav-item">
        <a class="nav-link active" href="/coordinatorschedule" style="font-size:18px">Calendar</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/manageemployees" style="font-size:18px">Employees</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/manageshifts" style="font-size:18px">Regular Shifts</a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="/managehours" style="font-size:18px">Hours</a>
      </li>
    </ul>
  </div>
</nav>

<main role="main">
  <div class="container">
    <div class="row">
      <div class="col-12">
        <br>
        <button type="button" id="lastWeekButton" class="btn btn-outline-dark btn-sm" aria-label="Last Week" style="position: absolute;right: 90px;display:inline-block;">
          <span class="fa fa-chevron-left" aria-hidden="true"></span>
        </button>
        <button type="button" id="nextWeekButton" class="btn btn-outline-dark btn-sm" aria-label="Next Week" style="position: absolute;right: 40px;display:inline-block;">
          <span class="fa fa-chevron-right" aria-hidden="true"></span>
        </button>
        <h1 style="font-size: 20px; display:inline-block"><u>Weekly Calendar</u></h1>
        <br>
        <br>
      </div>
    </div>
    <div class="row">
      <div class="mx-auto col-12 table-responsive-xl" style="overflow-y:">
        <table class="table" cellpadding="5" cellspacing="2" style="font-size:14px">
          <thead>
            <tr>
              <!-- <th> </th> -->
              <th class = "mon">Monday Dinner</th>
              <th class = "tue" >Tuesday Dinner</th>
              <th class = "wed" >Wednesday Dinner</th>
              <th class = "thu" >Thursday Dinner</th>
              <th class = "fri" >Friday &nbsp Dinner&nbsp </th>
              <th class = "sat" >Saturday Brunch</th>
              <th class = "sat">Saturday Dinner</th>
              <th class = "sun" >Sunday Brunch</th>
              <th class = "sun">Sunday Dinner</th>
            </tr>
            <tr>
              <!-- <th> </th> -->
              <td class = "mon" id="monDate"></td>
              <td class = "tue" id="tuesDate"></td>
              <td class = "wed" id ="wedDate"></td>
              <td class = "thu" id ="thursDate"></td>
              <td class = "fri" id="friDate"></td>
              <td class = "sat" id="satDate"></td>
              <td class = "sat" id="satDate2"></td>
              <td class = "sun" id="sunDate"></td>
              <td class = "sun" id = "sunDate2"></td>
            </tr>
          </thead>
          <tbody>
            <tr>
              <!-- <th>Shifts</th> -->
              <!--Monday Dinner-->
              <td id="monDinner" class="mon" day ="0">
                <div class="list-group">
                  <a href="#" id="0-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dinner Manager</a>
                  <a href="#" id="0-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dinner</a>
                  <a href="#" id="0-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dinner</a>
                </div>
              </td>
              <!--Tuesday Dinner-->
              <td id="tuesDinner" class="tue" day ="1">
                <div class="list-group">
                  <a href="#" id="1-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dinner Manager</a>
                  <a href="#" id="1-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dinner</a>
                  <a href="#" id="1-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dinner</a>
                </div>
              </td>

              <!--Wednesday Dinner-->
              <td id="wedDinner" class="wed" day ="2">
                <div class="list-group">
                  <a href="#" id="2-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dinner Manager</a>
                  <a href="#" id="2-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dinner</a>
                  <a href="#" id="2-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dinner</a>
                </div>
              </td>
              <!--Thursday Dinner-->
              <td id="thurDinner" class="thu" day ="3">
                <div class="list-group">
                  <a href="#" id="3-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dinner Manager</a>
                  <a href="#" id="3-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dinner</a>
                  <a href="#" id="3-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dinner</a>
                </div>
              </td>
              <!--Friday Dinner-->
              <td id="friDinner" class="fri" day ="4">
                <div class="list-group">
                  <a href="#" id="4-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dinner Manager</a>
                  <a href="#" id="4-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dinner</a>
                  <a href="#" id="4-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dinner</a>
                </div>
              </td>

              <!--Saturday Brunch-->
              <td id="satBrunch" class = "sat" day ="5" >
                <div class="list-group">
                  <!--					<div class="list-group" style = "width: 75px; font-size:12px" >-->
                  <a href="#" id="5-7" taskid = 7 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift" > Brunch Manager</a>
                  <a href="#" id="5-8" taskid = 8 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Brunch</a>
                  <a href="#" id="5-9" taskid = 9 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Brunch</a>
                </div>
              </td>


              <!--Saturday Dinner-->
              <td class = "sat" id="satDinner" day ="5">
                <div class="list-group">
                  <a href="#" id="5-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift"> Dinner Manager</a>
                  <a href="#" id="5-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dinner</a>
                  <a href="#" id="5-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dinner</a>
                </div>
              </td>

              <!--Sunday Brunch-->
              <td id="sunBrunch" class="sun" day ="6">
                <div class="list-group" >
                  <a href="#" id="6-7" taskid = 7 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift" > Brunch Manager</a>
                  <a href="#" id="6-8" taskid = 8 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift" >First Brunch</a>
                  <a href="#" id="6-9" taskid = 9 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Brunch</a>
                </div>
              </td>

              <!--Sunday Dinner Dish-->
              <td id="sunDinner" class="sun" day ="6">
                <div class="list-group" >
                  <a href="#" id="6-1" taskid = 1 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">  Dinner Manager</a>
                  <a href="#" id="6-2" taskid = 2 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dinner</a>
                  <a href="#" id="6-3" taskid = 3 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dinner</a>
                </div>
              </td>
            </tr>

            <tr>
              <!--Monday Dinner Dish-->
              <td id="monDish" class="mon" day ="0">
                <div class="list-group">
                  <a href="#" id="0-4" taskid = 4 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dish Manager</a>
                  <a href="#" id="0-5" taskid = 5 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="0-6" taskid = 6 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>
              <!--Tuesday Dinner Dish-->
              <td id="tuesDish" class="tue" day ="1">
                <div class="list-group">
                  <a href="#" id="1-4" taskid = 4 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dish Manager</a>
                  <a href="#" id="1-5" taskid = 5 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="1-6" taskid = 6 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>

              <!--Wednesday Dinner Dish-->
              <td id="wedDish" class="wed" day ="2">
                <div class="list-group">
                  <a href="#" id="2-4" taskid = 4 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dish Manager</a>
                  <a href="#" id="2-5" taskid = 5 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="2-6" taskid = 6 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>
              <!--Thursday Dinner Dish-->
              <td id="thurDish" class="thu" day ="3">
                <div class="list-group">
                  <a href="#" id="3-4" taskid = 4 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dish Manager</a>
                  <a href="#" id="3-5" taskid = 5 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="3-6" taskid = 6 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>
              <!--Friday Dinner Dish-->
              <td id="friDish" class="fri" day ="4">
                <div class="list-group">
                  <a href="#" id="4-4" taskid = 4 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Dish Manager</a>
                  <a href="#" id="4-5" taskid = 5 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="4-6" taskid = 6 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>

              <!--Saturday Brunch Dish-->
              <td id="satBrunchDish" class = "sat" day ="5" >
                <div class="list-group">
                  <!--					<div class="list-group" style = "width: 75px; font-size:12px" >-->
                  <a href="#" id="5-10" taskid = 10 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift" > Dish Manager</a>
                  <a href="#" id="5-11" taskid = 11 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="5-12" taskid = 12 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>


              <!--Saturday Dinner Dish-->
              <td id="satDinnerDish" class = "sat" day ="5">
                <div class="list-group">
                  <a href="#" id="5-4" taskid = 4 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift"> Dish Manager</a>
                  <a href="#" id="5-5" taskid = 5 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="5-6" taskid = 6 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>

              <!--Sunday Brunch Dish-->
              <td id="sunBrunchDish" class="sun" day ="6">
                <div class="list-group" >
                  <a href="#" id="6-10" taskid = 10 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift" > Dish Manager</a>
                  <a href="#" id="6-11" taskid = 11 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift" >First Dish</a>
                  <a href="#" id="6-12" taskid = 12 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>

              <!--Sunday Dinner Dish-->
              <td id="sunDinnerDish" class="sun" day ="6">
                <div class="list-group" >
                  <a href="#" id="6-4" taskid = 4 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">  Dish Manager</a>
                  <a href="#" id="6-5" taskid = 5 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">First Dish</a>
                  <a href="#" id="6-6" taskid = 6 class="list-group-item list-group-item-action list-group-item-light text-dark" data-container="body" data-toggle="modal"
                  data-target="#otherShift">Second Dish</a>
                </div>
              </td>
            </tr>

          </tbody>
        </table>
      </div>
    </div>
    <div class="row"></div>
    <br>
    <br>
    <br>
    <br>
    <!-- Modal with close button -->
    <div class="modal fade" id="otherShift" tabindex="-1" role="dialog" aria-labelledby="otherShiftLabel" aria-hidden="true">
      <div class="modal-dialog" role="document">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="otherShiftLabel">Shift Details</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body" id="otherShiftBody">
            <span id="otherShiftText"></span>
            <span id = "walkOnText" class="text-danger"></span>
          </div>
          <div class="modal-footer">
            <form id="walkOnForm" onsubmit="return false;">
              <label class="sr-only" for="walkOn">Username</label>
              <div class="input-group">
                <div class="input-group-prepend">
                  <div class="input-group-text">@</div>
                </div>
                <input type="text" class="form-control" id="walkOnInput" placeholder="netid">
                &nbsp&nbsp
                <button type="button" class="btn btn-secondary" id ="walkOnSubmit">Add Walk-On</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>
    <!-- Are You Sure? Modal -->
    <div id ="areYouSureModalNoShow" class="modal fade" tabindex="-1" role="dialog" aria-labelledby="areYouSureModal" aria-hidden="true">
      <div class="modal-dialog modal-sm">
        <div class="modal-content">
          <div class="modal-body">
            <div id="noshow-modal-text"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary btn-sm" id="yes-button-noshow">Yes</button>
            <button type="button" class="btn btn-secondary btn-sm" id="no-button-noshow">No</button>
          </div>
        </div>
      </div>
    </div>

  </div>
</main>

<input type="hidden" id="myShifts">
<input type="hidden" id="needsSubShifts">
<div id="monday" style="visibility:hidden">{{monday}}</div>


<footer class="footer">
  <span class="text-muted">&copy; <a class = "text-dark" href="/team">The ShiftScheduler Team</a> 2020</span>
</footer>

<script>

function getDates() {
  let mon = $('#monday').text().trim();
  console.log(mon);
  // has today's date
  let current = new Date();
  console.log("today: " + current)
  let dotw = current.getDay();

  // if (dotw == 0) {
  //   dotw = 7;
  // }
  console.log("dotw: " + dotw);
  if (dotw == 0) {
    dotw = 7;
  }
  offset = current.getTimezoneOffset();
  console.log("offset: " + offset);
  let monISO = new Date();
  monISO.setDate(current.getDate() - dotw + 1);
  // + 1 depending on timezone? idk not sure SOMETHING'S STILL WEIRD HERE
  // if ( >= 0) {
  //   monISO.setDate(today.getDate() - dotw);
  // }
  // else {
  //   monISO.setDate(today.getDate() - dotw + 1);
  // }
  monISO = format(monISO);
  // monISO = monISO.toISOString().substring(0, 10)
  console.log("monISO: " + monISO);
  console.log("mon:" + mon);
  if (mon == 'today' || mon == monISO) {
    var dayStr = null
    if(dotw  == 1) dayStr = '.mon';
    else if(dotw  == 2) dayStr = '.tue';
    else if(dotw  == 3) dayStr = '.wed';
    else if(dotw  == 4) dayStr = '.thu';
    else if(dotw  == 5) dayStr = '.fri';
    else if(dotw  == 6) dayStr = '.sat';
    else if(dotw  == 7) dayStr = '.sun';

    var classStr =  dayStr +  " table-warning";
    $(dayStr).attr("class" , classStr);
    mon = current.getDate() - dotw + 1;
    current.setDate(mon);
    console.log(mon);
  }
  else {
    // console.log(current);
    // console.log('mon: ' + mon);
    // console.log('offset: ' + offset);
    current = new Date(mon);
    // console.log('current: ' + current);
    if (offset >= 0) {
      current.setDate(current.getDate() + 1);
    }
    // console.log('start: ' + current);
  }
  let week = [];
  // console.log(current);
  for (var i = 0; i < 7; i++) {
    week.push(new Date(current));
    current.setDate(current.getDate()+1);
  }
  // console.log(week[0]);
  $('#monDate').html(week[0].toLocaleDateString());
  $('#tuesDate').html(week[1].toLocaleDateString());
  $('#wedDate').html(week[2].toLocaleDateString());
  $('#thursDate').html(week[3].toLocaleDateString());
  $('#friDate').html(week[4].toLocaleDateString());
  $('#satDate').html(week[5].toLocaleDateString());
  $('#satDate2').html(week[5].toLocaleDateString());
  $('#sunDate').html(week[6].toLocaleDateString());
  $('#sunDate2').html(week[6].toLocaleDateString());

  return week[0];
  // var test = new Date(2020, 3, 13);
  // return test;
}

function getSubColors(mon) {
  console.log("mon " + mon);
  url = '/myShifts'
  url = '/needSubShifts?mon=' + mon
  $('#needsSubShifts').load(url, function(responseTxt, statusTxt, xhr){
    var found = false;
    for (var i = 0; i < responseTxt.length; i++) {
      curr = responseTxt[i];
      if (curr == "\"") {
        if (!found) {
          found = true;
          var id = "#" + responseTxt.substring(i + 1, i + 4);
          $(id).attr("class", "list-group-item list-group-item-action list-group-item-danger");
        }
        else {
          found = false;
        }
      }
    }
  });
}

function getModalData(mon) {
  $('[data-toggle="modal"]').on('click',function() {
    $("#walkOnInput").val('');
    $("#walkOnText").val('');
    var dataURL = "/shiftdetailsco";
    var taskId = $(this).attr('taskid');
    var dotw = $(this).parents('td').attr("day");
    var date = new Date();
    date.setFullYear(mon.getFullYear(), mon.getMonth(), mon.getDate());
    date.setDate(date.getDate() + parseInt(dotw));
    var iso = format(date);
    // var iso = date.toISOString().substring(0, 10);
    console.log('modal toggled, iso= ' + iso);

    // var walkOnUrl = "/walkOn?"
    // $("#walkOnText").text('');
    // walkOnUrl += "date=" + iso;
    // console.log(iso);
    // walkOnUrl += "&taskid=" + taskId;
    // console.log(taskId);

    // console.log(iso);
    dataURL += "?date=" + iso;
    dataURL += "&taskid=" + taskId;
    var modalId = $(this).attr('data-target');

    if (modalId == '#otherShift') {
      $('#otherShiftText').load(dataURL,function() {
        console.log('here');
        $('#otherShift').modal('show');

        $(".noShow").on("click", function(){
          $(this).attr('disabled', true);
          var url = $(this).attr("href");
          var noShowNetID = $(this).attr("netid").trim();
          var noShowArea = '\"#noshow'  + noShowNetID + '\"';
          $(this).parent("span").load(url);
        });

        $(".undoNoShow").on("click", function(){
          $(this).attr('disabled', true);
          var url = $(this).attr("href");
          var noShowNetID = $(this).attr("netid").trim();
          var noShowArea = '\"#noshow'  + noShowNetID + '\"';
          $(this).parent("span").load(url);
        });

        // $(".noShow").on("click", function(){
        //   var netid = $(this).attr("netid").trim();
        //   console.log($(this).parent("span").attr('html'));
        //   var id = $(this).attr("id");
        //   console.log(netid);
        //   console.log(id);
        //   console.log('clicked');
        //   $('#otherShift').modal('hide');
        //   $('#areYouSureModalNoShow').modal('show');
        //   $('#noshow-modal-text').html('Are you sure that you want to mark <strong>' + netid + '</strong> as a no-show? This action cannot be undone.');
        //   $("#yes-button-noshow").attr('netid', netid);
        //   $("#yes-button-noshow").attr('id', '#' + id);
        // });

        // $("#yes-button-noshow").on("click", function(){
        //   $('#areYouSureModalNoShow').modal('hide');
        //   $('#otherShift').modal('show');
        //   var id = $(this).attr("id");
        //   console.log(id);
        //   var url = $(id).attr("href");
        //   console.log(url);
        //   var noShowNetID = $(id).attr("netid").trim();
        //   console.log(noShowNetID);
        //   var noShowArea = '\"#noshow'  + noShowNetID + '\"';
        //   $(id).parent("span").load(url);
        // });
        //
        // $('#no-button-noshow').on('click',function() {
        //   $('#areYouSureModalNoShow').modal('hide');
        //   $('#otherShift').modal('show');
        // });

        $("#walkOnSubmit").on("click", function() {
          $("#walkOnSubmit").attr('disabled', true);
          var walkOnNetId = $("#walkOnInput").val();
          if (walkOnNetId == '') {
            $("#walkOnText").html("<br><br>Please enter a net ID.");
            $("#walkOnSubmit").attr('disabled', false);
            return;
          }
          var walkOnUrl = "/walkOn?"
          $("#walkOnText").text('');
          walkOnUrl += "date=" + iso;
          console.log(iso);
          walkOnUrl += "&taskid=" + taskId;
          console.log(taskId);
          console.log(walkOnUrl);
          walkOnUrl += "&netid=" + walkOnNetId;
          // var currText = $("#walkOnText").text();
          // console.log(currText);
          console.log($('#otherShiftText').html());
          // $('#otherShiftText').html() += 'hello';
          $.ajax({
            url: walkOnUrl,
            type: 'POST',
            success: function(data){
              $("#walkOnSubmit").attr('disabled', false);
              if (data == "failed") {
                $("#walkOnText").html("<br><br>walkOn Request Failed. Please try again.");
                $("#walkOnInput").val('');
              }
              else {
                console.log(data)
                curr = $('#otherShiftText').html() + data;
                // console.log(curr);
                $('#otherShiftText').html(curr);
                $("#walkOn").val('');
              }
              $(".noShow").on("click", function(){
                $(this).attr('disabled', true);
                var url = $(this).attr("href");
                var noShowNetID = $(this).attr("netid").trim();
                var noShowArea = '\"#noshow'  + noShowNetID + '\"';
                $(this).parent("span").load(url);
              });
              $(".undoNoShow").on("click", function(){
                $(this).attr('disabled', true);
                var url = $(this).attr("href");
                var noShowNetID = $(this).attr("netid").trim();
                var noShowArea = '\"#noshow'  + noShowNetID + '\"';
                $(this).parent("span").load(url);
              });
            }
          });
          // $("#walkOnText").load(walkOnUrl);
          // console.log(currText);
          // $("#walkOnText").text(currText + '<br>' + 'netid');
          // console.log($("#walkOn").text());
          $("#walkOnInput").val('');
          $('#otherShift').on('hide.bs.modal',function() {
            console.log('closed');
            window.location.reload();
          });
        });

        $("#walkOnInput").on("keydown", function (e) {
          // console.log('input');
          if (e.keyCode === 13) {  //checks whether the pressed key is "Enter"
            $('#walkOnInput').attr('disabled', true);
            var walkOnNetId = $("#walkOnInput").val();
            if (walkOnNetId == '') {
              $("#walkOnText").html("<br><br>Please enter a net ID.");
              $('#walkOnInput').attr('disabled', false);
              return;
            }
            var walkOnUrl = "/walkOn?"
            $("#walkOnText").text('');
            walkOnUrl += "date=" + iso;
            console.log(iso);
            walkOnUrl += "&taskid=" + taskId;
            console.log(taskId);
            console.log(walkOnUrl);
            walkOnUrl += "&netid=" + walkOnNetId;
            // var currText = $("#walkOnText").text();
            // console.log(currText);
            console.log($('#otherShiftText').html());
            // $('#otherShiftText').html() += 'hello';
            $.ajax({
              url: walkOnUrl,
              type: 'POST',
              success: function(data){
                $('#walkOnInput').attr('disabled', false);
                if (data == "failed") {
                  $("#walkOnText").html("<br><br>walkOn Request Failed. Please try again.");
                  $("#walkOnInput").val('');
                }
                else {
                  console.log(data)
                  curr = $('#otherShiftText').html() + data;
                  // console.log(curr);
                  $('#otherShiftText').html(curr);
                  $("#walkOn").val('');
                }
                $(".noShow").on("click", function(){
                  $(this).attr('disabled', true);
                  var url = $(this).attr("href");
                  var noShowNetID = $(this).attr("netid").trim();
                  var noShowArea = '\"#noshow'  + noShowNetID + '\"';
                  $(this).parent("span").load(url);
                });
              }
            });
            // $("#walkOnText").load(walkOnUrl);
            // console.log(currText);
            // $("#walkOnText").text(currText + '<br>' + 'netid');
            // console.log($("#walkOn").text());
            $("#walkOnInput").val('');
            $('#otherShift').on('hide.bs.modal',function() {
              console.log('closed');
              window.location.reload();
            });
          }
        });
      });
    }
  });
  $('#otherShift').on('hide.bs.modal',function() {
    // console.log('closed normally');
    $('#walkOnSubmit').off('click');
    // window.location.reload();
  });
  // $('#otherShift').on('shown.bs.modal', function (e) {
  //   console.log('hello');
  // });
}

function format(mon) {
  monFormat = mon.getFullYear() + '-';
  if (mon.getMonth() < 10 ) {
    monFormat += "0" + (mon.getMonth()+1) + '-';
  } else {
    monFormat += mon.getMonth() + '-' ;
  }

  if(mon.getDate() < 10 ){
    monFormat += "0" + (mon.getDate());
  } else {
    monFormat += mon.getDate();
  }
  return monFormat;
}

// let request = null;

function lastWeek(mon) {
  $('#lastWeekButton').on('click',function() {
    console.log(mon);
    let newMon = new Date(mon);
    newMon.setDate(newMon.getDate() - 7);
    console.log(newMon);
    window.location = "?monday=" + format(newMon)
  });
}

function nextWeek(mon) {
  $('#nextWeekButton').on('click',function() {
    console.log(mon);
    let newMon = new Date(mon);
    newMon.setDate(newMon.getDate() + 7);
    console.log(newMon);
    window.location = "?monday=" + format(newMon);
  });
}

function setup() {
  mon = getDates();
  console.log(mon);
  monFormat = format(mon);
  getModalData(mon);
  getSubColors(monFormat);
  lastWeek(mon);
  nextWeek(mon);
}

$('document').ready(setup);
</script>

</body>
</html>
